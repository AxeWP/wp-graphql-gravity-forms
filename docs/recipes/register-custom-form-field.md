# Recipes

## How to: register query support for a custom Gravity Forms Field

While this plugin offers [basic support for custom Gravity Forms fields out of the box](../form-field-support.md), in many cases you will want to extend the GraphQL schema to provide your custom field data.

The below methods can also be used to add extended support for core Gravity Form fields that are [not yet fully supported](../form-field-support.md#experimental-fields).

Note: You will need to [add a FormFieldValueInput](./register-custom-field-value-inputs.md) in order to be able submit/update your Gravity Forms field.

### Method 1: Quick and Dirty

If you're only adding a few fields to the schema, WPGraphQL's native `register_graphql_field()` should do the trick.

For example:

```php
register_graphql_field(
  'MyCustomFormField', // This is autogenerated by the plugin based on the GF_Field::$type. Check the schema for the correct name.
  'myCustomProperty',
  [
    'type' => 'String',
    'description' => __( 'This is a custom property that exists on my custom GF field', 'my-plugin' ),
    'resolve' => fn( $source ) => $source->my_custom_property // if the GF_Field property is the same name as the GraphQL field, this can be ommitted.
  ]
);
```

The same approach would also would to resolve a custom Form field value:

```php
register_graphql_field(
  'myCustomFormField', // This is autogenerated by the plugin based on the GF_Field::$type. Check the schema for the correct name.
  'myCustomFormFieldValue',
  [
    'type' => 'MyCustomFormFieldValueObject',
    'description' => __( 'The Field Value object for my custom GF field.', 'my-plugin'),
    'resolve' => function( $source ){
      /**
       * Usually, the entry is saved in the formField's context/
       * If you are fetching this field in a custom setup, you may need to use GFAPI::get_entry().
       */
      if( ! isset( $context->gfEntry->entry ) ){
        return null;
      }

      // Grab the field value from the entry, null if it isnt set.
      $value = $context->gfEntry->entry[ $source->id ] ?? null;

      // This will be resolved by `MyCustomFieldFieldValueObject`.
      return process_my_custom_field_value($value);
    }
  ]
);

```

### Method 2: Mapping Gravity Forms Field Settings

For complex Form fields, or groups of Form fields that share the a similar set of properties, it may often be a better practice to have your custom GraphQL fields registered automatically using `GF_Field::get_form_editor_field_settings()` .

To add support for your custom field settings, you can make use of [the `graphql_gf_form_field_setting_properties` filter](../actions-and-filters.md):

```php
add_filter(
  'graphql_gf_form_field_setting_properties',
  function( array $properties, string $setting_key, \GF_Field $field ) {
    // All GF_Fields that register this setting will have the following GraphQL fields assigned.
    if ('my_custom_setting' === $setting_key ) {
      $properties += [
        'myCustomFormFieldProperty' => [ // The field name to register.
          'type' => 'String',
          'description' => __( 'This is a custom property that exists on my custom GF field', 'my-plugin' ),
          'resolve' => fn( $source ) => $source->my_custom_property // if the GF_Field property is the same name as the GraphQL field, this can be ommitted.
        ]
      ];

      /**
       * Conditionally add a custom field value to only some fields that use this setting.
       * 
       * For illustration purposes only. When registering custom form field values, we recommend the `graphql_gf_form_field_value_properties` filter, which works the same way.
       */
      if( 'myothercustom' === $field->type ){
        $properties += [
          'myOtherCustomFormFieldProperty',
          [
            'type' => 'MyCustomFormFieldValueObject',
            'description' => __( 'The Field Value object for my custom GF field.', 'my-plugin'),
            'resolve' => function( $source ){
              /**
               * Usually, the entry is saved in the formField's context/
               * If you are fetching this field in a custom setup, you may need to use GFAPI::get_entry().
               */
              if( ! isset( $context->gfEntry->entry ) ){
                return null;
              }

              // Grab the field value from the entry, null if it isnt set.
              $value = $context->gfEntry->entry[ $source->id ] ?? null;

              // This will be resolved by `MyCustomFieldFieldValueObject`.
              return process_my_custom_field_value($value);
            }
          ]
        ]
      }
    }
  },
  10,
  3
);

```

### Form Fields with dynamic types

Gravity Forms currently has no standardized way of knowing the possible input types a Form Field might use. When adding support for a custom Form Field that supports multiple input types, you need to manually define what those types are.

This can be done by overriding the array of key-value pairs of GF_Field types and the GraphQL Type to generate with [the `graphql_gf_form_field_child_types` filter](../actions-and-filters.md).

```php
add_filter(
  'graphql_gf_form_field_child_types',
  function( array $possible_input_types, array $field_type ) : array {
    // Add support for a custom field.
    if( 'mycustomfield' = $field_type ) {
      $possible_input_types = [
        'checkbox' => 'MyCustomCheckboxField',
        'radio' => 'MyCustomRadioField',
      ];
    }

    // Change the possible input types for an existing GF Field.
    if( 'post_custom_field' === $field_type ) {
      // Add an input type.
      $possible_input_types[] = [ 'mycustomfield' => 'PostCustomMyCustomField' ];

      // Remove an input type
      unset( $possible_input_types['list'] );
    }
  }
  10,
  2
);
```
